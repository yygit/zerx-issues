
<!DOCTYPE html>
<html lang="en">
<head>
  <meta id="bb-bootstrap" data-current-user="{&quot;username&quot;: &quot;yybitb&quot;, &quot;displayName&quot;: &quot;yybitb&quot;, &quot;uuid&quot;: &quot;{d2ee9cfe-6807-4b0b-b199-aec6bc17e1c6}&quot;, &quot;firstName&quot;: &quot;yybitb&quot;, &quot;hasPremium&quot;: false, &quot;lastName&quot;: &quot;&quot;, &quot;avatarUrl&quot;: &quot;https://bitbucket.org/account/yybitb/avatar/32/?ts=1505382991&quot;, &quot;isTeam&quot;: false, &quot;isSshEnabled&quot;: true, &quot;isKbdShortcutsEnabled&quot;: false, &quot;id&quot;: 2756606, &quot;isAuthenticated&quot;: true}"
data-atlassian-id="557058:50b49aec-0028-4a41-8874-55077e86133c" />
  
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta charset="utf-8">
  <title>
  mst777 / zerx_tv 
  / issues 
  / #598 - Рефакторинг вызова CURL

 &mdash; Bitbucket
</title>
  <script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,n,t){function r(t){if(!n[t]){var o=n[t]={exports:{}};e[t][0].call(o.exports,function(n){var o=e[t][1][n];return r(o||n)},o,o.exports)}return n[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<t.length;o++)r(t[o]);return r}({1:[function(e,n,t){function r(){}function o(e,n,t){return function(){return i(e,[c.now()].concat(u(arguments)),n?null:this,t),n?void 0:this}}var i=e("handle"),a=e(2),u=e(3),f=e("ee").get("tracer"),c=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(e,n){s[n]=o(d+n,!0,"api")}),s.addPageAction=o(d+"addPageAction",!0),s.setCurrentRouteName=o(d+"routeName",!0),n.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,n){var t={},r=this,o="function"==typeof n;return i(l+"tracer",[c.now(),e,t],r),function(){if(f.emit((o?"":"no-")+"fn-start",[c.now(),r,o],t),o)try{return n.apply(this,arguments)}finally{f.emit("fn-end",[c.now()],t)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,n){m[n]=o(l+n)}),newrelic.noticeError=function(e){"string"==typeof e&&(e=new Error(e)),i("err",[e,c.now()])}},{}],2:[function(e,n,t){function r(e,n){var t=[],r="",i=0;for(r in e)o.call(e,r)&&(t[i]=n(r,e[r]),i+=1);return t}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],3:[function(e,n,t){function r(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(o<0?0:o);++r<o;)i[r]=e[n+r];return i}n.exports=r},{}],4:[function(e,n,t){n.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,n,t){function r(){}function o(e){function n(e){return e&&e instanceof r?e:e?f(e,u,i):i()}function t(t,r,o,i){if(!d.aborted||i){e&&e(t,r,o);for(var a=n(o),u=m(t),f=u.length,c=0;c<f;c++)u[c].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(e,n){v[e]=m(e).concat(n)}function m(e){return v[e]||[]}function w(e){return p[e]=p[e]||o(t)}function g(e,n){c(e,function(e,t){n=n||"feature",y[t]=n,n in s||(s[n]=[])})}var v={},y={},b={on:l,emit:t,get:w,listeners:m,context:n,buffer:g,abort:a,aborted:!1};return b}function i(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var u="nr@context",f=e("gos"),c=e(2),s={},p={},d=n.exports=o();d.backlog=s},{}],gos:[function(e,n,t){function r(e,n,t){if(o.call(e,n))return e[n];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,n,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[n]=r,r}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],handle:[function(e,n,t){function r(e,n,t,r){o.buffer([e],r),o.emit(e,n,t)}var o=e("ee").get("handle");n.exports=r,r.ee=o},{}],id:[function(e,n,t){function r(e){var n=typeof e;return!e||"object"!==n&&"function"!==n?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");n.exports=r},{}],loader:[function(e,n,t){function r(){if(!x++){var e=h.info=NREUM.info,n=d.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&n))return s.abort();c(y,function(n,t){e[n]||(e[n]=t)}),f("mark",["onload",a()+h.offset],null,"api");var t=d.createElement("script");t.src="https://"+e.agent,n.parentNode.insertBefore(t,n)}}function o(){"complete"===d.readyState&&i()}function i(){f("mark",["domContent",a()+h.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(u=Math.max((new Date).getTime(),u))-h.offset}var u=(new Date).getTime(),f=e("handle"),c=e(2),s=e("ee"),p=window,d=p.document,l="addEventListener",m="attachEvent",w=p.XMLHttpRequest,g=w&&w.prototype;NREUM.o={ST:setTimeout,SI:p.setImmediate,CT:clearTimeout,XHR:w,REQ:p.Request,EV:p.Event,PR:p.Promise,MO:p.MutationObserver};var v=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1044.min.js"},b=w&&g&&g[l]&&!/CriOS/.test(navigator.userAgent),h=n.exports={offset:u,now:a,origin:v,features:{},xhrWrappable:b};e(1),d[l]?(d[l]("DOMContentLoaded",i,!1),p[l]("load",r,!1)):(d[m]("onreadystatechange",o),p[m]("onload",r)),f("mark",["firstbyte",u],null,"api");var x=0,E=e(4)},{}]},{},["loader"]);</script>
  



<meta id="bb-canon-url" name="bb-canon-url" content="https://bitbucket.org">
<meta name="bb-api-canon-url" content="https://api.bitbucket.org">
<meta name="apitoken" content="{&quot;token&quot;: &quot;j2oWpranlY1ak2rQ4pxg-iRsWZU7jJ6hgiko9H-gSg0JUguLNliCUD_e08WxyUI2kqqD1Y9hWD6CmM9KgE4KCZBmov7dIZQLmGBLLsPWG83xVD8=&quot;, &quot;expiration&quot;: 1505383460.920716}">

<meta name="bb-commit-hash" content="4373ea877c7d">
<meta name="bb-app-node" content="app-164">
<meta name="bb-view-name" content="bitbucket.apps.issues.views.issue">
<meta name="ignore-whitespace" content="False">
<meta name="tab-size" content="None">
<meta name="locale" content="en">

<meta name="application-name" content="Bitbucket">
<meta name="apple-mobile-web-app-title" content="Bitbucket">


  
  <meta name="theme-color" content="#0049B0">
  <meta name="msapplication-TileColor" content="#0052CC">
  <meta name="msapplication-TileImage" content="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/img/logos/bitbucket/mstile-150x150.png">
  <link rel="apple-touch-icon" sizes="180x180" type="image/png" href="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/img/logos/bitbucket/apple-touch-icon.png">
  <link rel="icon" sizes="192x192" type="image/png" href="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/img/logos/bitbucket/android-chrome-192x192.png">
  <link rel="icon" sizes="16x16 24x24 32x32 64x64" type="image/x-icon" href="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/img/logos/bitbucket/favicon_2017.ico">
  <link rel="mask-icon" href="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/img/logos/bitbucket/safari-pinned-tab.svg" color="#0052CC">



<link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="Bitbucket">

  <meta name="description" content="">
  
  
    
  



  <link rel="stylesheet" href="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/css/entry/vendor.css" />
<link rel="stylesheet" href="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/css/entry/app.css" />




  <link rel="stylesheet" href="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/css/entry/adg3.css">

  
  <script nonce="R8rBu1g29CAnA2xS">
  window.__sentry__ = {"dsn": "https://ea49358f525d4019945839a3d7a8292a@sentry.io/159509", "release": "4373ea877c7d (production)", "tags": {"project": "bitbucket-core"}, "environment": "production"};
</script>
<script src="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/dist/webpack/sentry.js"></script>
  <script src="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/dist/webpack/early.js"></script>
  
  
  
    <link href="/mst777/zerx_tv/rss?token=7c53a8e19608437c17f0f33b3250abd0" rel="alternate nofollow" type="application/rss+xml" title="RSS feed for zerx_tv" />

  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:site" content="@bitbucket"/>
  <meta name="og:type" content="bitbucket:issue"/>
  <meta name="og:title" content="Рефакторинг вызова CURL"/>
  <meta name="og:url" content="https://bitbucket.org/mst777/zerx_tv/issues/598/curl"/>
  
    <meta name="og:description" content="Предлагаю вынести все вызовы функции CURL в отдельный класси и использовать для этого репозиторий:

https://github.com/php-curl-class/php-curl-class

Судя по документации, класс удобен в обращении:

```
$curl = new Curl();
$curl-&gt;setBasicAuthentication(&#39;username&#39;, &#39;password&#39;);
$curl-&gt;setUserAgent(&#39;&#39;);
$curl-&gt;setReferrer(&#39;&#39;);
$curl-&gt;setHeader(&#39;X-Requested-With&#39;, &#39;XMLHttpRequest&#39;);
$curl-&gt;setCookie(&#39;key&#39;, &#39;value&#39;);
$curl-&gt;get(&#39;http://www.example.com/&#39;);

if ($curl-&gt;error) {
    echo &#39;Error: &#39; . $curl-&gt;errorCode . &#39;: &#39; . $curl-&gt;errorMessage;
}
else {
    echo $curl-&gt;response;
}

var_dump($curl-&gt;requestHeaders);
var_dump($curl-&gt;responseHeaders);
```

и идет как composer зависимость.

Этот класс нужно будет расширить, чтобы по умолчанию он использовал или не использовал прокси-серверы в зависимости от настроек сайта. Возможность перегрузки настроек должна присутствовать, так как не везде в проекте нужно использование прокси-сервера."/>
  
  
    <meta name="og:image" content="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/img/repo-avatars/default.svg"/>
  

</head>
<body class="production adg3 "
    data-static-url="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/"
data-base-url="https://bitbucket.org"
data-no-avatar-image="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/img/default_avatar/user_blue.svg"
data-current-user="{&quot;username&quot;: &quot;yybitb&quot;, &quot;displayName&quot;: &quot;yybitb&quot;, &quot;uuid&quot;: &quot;{d2ee9cfe-6807-4b0b-b199-aec6bc17e1c6}&quot;, &quot;firstName&quot;: &quot;yybitb&quot;, &quot;hasPremium&quot;: false, &quot;lastName&quot;: &quot;&quot;, &quot;avatarUrl&quot;: &quot;https://bitbucket.org/account/yybitb/avatar/32/?ts=1505382991&quot;, &quot;isTeam&quot;: false, &quot;isSshEnabled&quot;: true, &quot;isKbdShortcutsEnabled&quot;: false, &quot;id&quot;: 2756606, &quot;isAuthenticated&quot;: true}"
data-atlassian-id="{&quot;loginStatusUrl&quot;: &quot;https://id.atlassian.com/profile/rest/profile&quot;}"
data-settings="{&quot;MENTIONS_MIN_QUERY_LENGTH&quot;: 3}"

data-current-repo="{&quot;scm&quot;: &quot;git&quot;, &quot;readOnly&quot;: false, &quot;mainbranch&quot;: {&quot;name&quot;: &quot;master&quot;}, &quot;language&quot;: &quot;&quot;, &quot;owner&quot;: {&quot;username&quot;: &quot;mst777&quot;, &quot;uuid&quot;: &quot;102fbc9b-6b05-444d-b783-fe5fbf7c8001&quot;, &quot;isTeam&quot;: false}, &quot;fullslug&quot;: &quot;mst777/zerx_tv&quot;, &quot;slug&quot;: &quot;zerx_tv&quot;, &quot;id&quot;: 10268036, &quot;pygmentsLanguage&quot;: null}"






data-browser-monitoring="true"
data-switch-create-pullrequest-commit-status="true"


data-atlassian-editor-enabled="true"
data-atlassian-emoji-base-url="https://pf-emoji-service.atlassian.io/emoji/"
>
<div id="page">
  
    
      <div id="adg3-navigation"
  
  
  
  <nav class="skeleton-nav">
    <div class="skeleton-nav--left">
      <div class="skeleton-nav--left-top">
        <ul class="skeleton-nav--items">
          <li></li>
          <li></li>
          <li></li>
          <li class="skeleton--icon"></li>
          <li class="skeleton--icon-sub"></li>
          <li class="skeleton--icon-sub"></li>
          <li class="skeleton--icon-sub"></li>
          <li class="skeleton--icon-sub"></li>
          <li class="skeleton--icon-sub"></li>
          <li class="skeleton--icon-sub"></li>
        </ul>
      </div>
      <div class="skeleton-nav--left-bottom">
        <div class="skeleton-nav--left-bottom-wrapper">
          <div class="skeleton-nav--item-help"></div>
          <div class="skeleton-nav--item-profile"></div>
        </div>
      </div>
    </div>
    <div class="skeleton-nav--right">
      <ul class="skeleton-nav--items-wide">
        <li class="skeleton--icon-logo-container">
          <div class="skeleton--icon-container"></div>
          <div class="skeleton--icon-description"></div>
          <div class="skeleton--icon-logo"></div>
        </li>
        <li>
          <div class="skeleton--icon-small"></div>
          <div class="skeleton-nav--item-wide-content"></div>
        </li>
        <li>
          <div class="skeleton--icon-small"></div>
          <div class="skeleton-nav--item-wide-content"></div>
        </li>
        <li>
          <div class="skeleton--icon-small"></div>
          <div class="skeleton-nav--item-wide-content"></div>
        </li>
        <li>
          <div class="skeleton--icon-small"></div>
          <div class="skeleton-nav--item-wide-content"></div>
        </li>
        <li>
          <div class="skeleton--icon-small"></div>
          <div class="skeleton-nav--item-wide-content"></div>
        </li>
        <li>
          <div class="skeleton--icon-small"></div>
          <div class="skeleton-nav--item-wide-content"></div>
        </li>
      </ul>
    </div>
  </nav>
</div>


    
    <div id="wrapper">
      
  
  


      

      
  
    <div id="nps-survey-container"></div>
  


      
  

<div id="account-warning" data-module="header/account-warning"
  data-unconfirmed-addresses="false"
  data-no-addresses="false"
  
></div>



      
  
<header id="aui-message-bar">
  
</header>


    <div id="content" role="main">
      
        
          <header class="app-header">
            <div class="app-header--primary">
              
                <div class="app-header--context">
                  <div class="app-header--breadcrumbs">
                    
            <ol class="aui-nav aui-nav-breadcrumbs">
              <li>
  <a href="/mst777/">DiMaco mb</a>
</li>

<li>
  <a href="/mst777/zerx_tv">zerx_tv</a>
</li>
              
  <li>
    <a href="/mst777/zerx_tv/issues?status=new&amp;status=open">
      Issues
    </a>
  </li>

            </ol>
          
                  </div>
                  <h1 class="app-header--heading">
                    Issues
                  </h1>
                </div>
                
              </div>
              <div class="app-header--secondary">
                
                  
    
  
    <a id="create-issue-contextual" href="/mst777/zerx_tv/issues/new"
        class="aui-button">
      
      <span class="aui-button-label">Create issue</span>
    </a>
  

                
              </div>
            </header>
          
        
        
  

        
  <div class="aui-page-panel ">
    <div class="hidden">
  
  </div>
    <div class="aui-page-panel-inner">

      <div
        id="repo-content"
        class="aui-page-panel-content forks-enabled can-create"
        data-module="repo/index"
        
      >
        
        
        
  <div id="issues" class="clearfix">
    
  
  <section id="issue-view" class=""
      data-id="15611222"
      data-local-id="598"
      data-status="3">
    <div id="issue-header" class="clearfix">
      <span class="issue-id">
        
          Issue #598
        
      </span>
      <a href="/mst777/zerx_tv/issues?status=resolved">
        <span class="aui-lozenge aui-lozenge-success">resolved</span>
      </a>
      
        <div class="issue-toolbar">
          
            <div id="workflow-dropdown" class="aui-dropdown2 aui-style-default">
              <ul>
                <li data-transition-to="1" title="Mark as new"><a>new</a></li>
                <li data-transition-to="2" title="Open issue"><a>open</a></li>
                <li data-transition-to="4" title="Put on hold"><a>on hold</a></li>
                <li data-transition-to="3" title="Resolve issue"><a>resolved</a></li>
                <li data-transition-to="6" title="Mark as duplicate"><a>duplicate</a></li>
                <li data-transition-to="5" title="Mark as invalid"><a>invalid</a></li>
                <li data-transition-to="7" title="Mark as wontfix"><a>wontfix</a></li>
                <li data-transition-to="8" title="Close issue"><a>closed</a></li>
              </ul>
            </div>
            
    
    
  
            
    
    
  
            <div id="issue-actions" class="aui-buttons">
              
                <a id="change-state" class="aui-button aui-button-primary" data-transition-to="2" href="#reopen" title="Open issue">
                  Open
                </a>
              
              <a href="#workflow" id="workflow" class="aui-button aui-dropdown2-trigger"
                  aria-owns="workflow-dropdown" aria-haspopup="true">
                <span class="dropdown-text">Workflow</span>
              </a>
            </div>
          
          
            <div class="aui-buttons">
              <a href="#attach" class="issue-attach-link aui-button">
                Attach
              </a>
            </div>
          
          
            <div class="aui-buttons">
              <a href="/mst777/zerx_tv/issues/edit/598" id="edit-issue" class="aui-button">Edit</a>
            </div>
          
          
        </div>
        
    
    
  
      
    </div>
    <div class="aui-group">
      <div class="aui-item">
        <div id="issue-main-content">
          <h1 id="issue-title">Рефакторинг вызова CURL</h1>

          <div class="issue-author">
            
              


  
    <a href="/icamys/" title="Dmitrii Prisacari">
      <div class="aui-avatar aui-avatar-medium">
        <div class="aui-avatar-inner">
          <img src="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/img/default_avatar/user_blue.svg" class="deferred-image"
              data-src-url="https://bitbucket.org/account/icamys/avatar/32/?ts=1505378342"
              data-src-url-2x="https://bitbucket.org/account/icamys/avatar/64/?ts=1505378342" alt="">
        </div>
      </div>
  
      <span title="Dmitrii Prisacari">Dmitrii Prisacari</span>
  
    </a>
  

            
            
            
            created an issue
            <time datetime="2016-04-26T10:26:44.827065+00:00">2016-04-26</time>
          </div>
          <div class="issue-description wiki-content">
            
              <p>Предлагаю вынести все вызовы функции CURL в отдельный класси и использовать для этого репозиторий:</p>
<p><a href="https://github.com/php-curl-class/php-curl-class" rel="nofollow">https://github.com/php-curl-class/php-curl-class</a></p>
<p>Судя по документации, класс удобен в обращении:</p>
<div class="codehilite"><pre><span></span><span class="o">$</span><span class="nt">curl</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">Curl</span><span class="o">();</span>
<span class="o">$</span><span class="nt">curl-</span><span class="o">&gt;</span><span class="nt">setBasicAuthentication</span><span class="o">(</span><span class="s1">&#39;username&#39;</span><span class="o">,</span> <span class="s1">&#39;password&#39;</span><span class="o">);</span>
<span class="o">$</span><span class="nt">curl-</span><span class="o">&gt;</span><span class="nt">setUserAgent</span><span class="o">(</span><span class="s1">&#39;&#39;</span><span class="o">);</span>
<span class="o">$</span><span class="nt">curl-</span><span class="o">&gt;</span><span class="nt">setReferrer</span><span class="o">(</span><span class="s1">&#39;&#39;</span><span class="o">);</span>
<span class="o">$</span><span class="nt">curl-</span><span class="o">&gt;</span><span class="nt">setHeader</span><span class="o">(</span><span class="s1">&#39;X-Requested-With&#39;</span><span class="o">,</span> <span class="s1">&#39;XMLHttpRequest&#39;</span><span class="o">);</span>
<span class="o">$</span><span class="nt">curl-</span><span class="o">&gt;</span><span class="nt">setCookie</span><span class="o">(</span><span class="s1">&#39;key&#39;</span><span class="o">,</span> <span class="s1">&#39;value&#39;</span><span class="o">);</span>
<span class="o">$</span><span class="nt">curl-</span><span class="o">&gt;</span><span class="nt">get</span><span class="o">(</span><span class="s1">&#39;http://www.example.com/&#39;</span><span class="o">);</span>

<span class="nt">if</span> <span class="o">($</span><span class="nt">curl-</span><span class="o">&gt;</span><span class="nt">error</span><span class="o">)</span> <span class="p">{</span>
    <span class="err">echo</span> <span class="err">&#39;</span><span class="n">Error</span><span class="p">:</span> <span class="s1">&#39; . $curl-&gt;errorCode . &#39;</span><span class="o">:</span> <span class="err">&#39;</span> <span class="o">.</span> <span class="err">$</span><span class="n">curl-</span><span class="o">&gt;</span><span class="n">errorMessage</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">else</span> <span class="p">{</span>
    <span class="err">echo</span> <span class="err">$curl-&gt;response</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">var_dump</span><span class="o">($</span><span class="nt">curl-</span><span class="o">&gt;</span><span class="nt">requestHeaders</span><span class="o">);</span>
<span class="nt">var_dump</span><span class="o">($</span><span class="nt">curl-</span><span class="o">&gt;</span><span class="nt">responseHeaders</span><span class="o">);</span>
</pre></div>


<p>и идет как composer зависимость.</p>
<p>Этот класс нужно будет расширить, чтобы по умолчанию он использовал или не использовал прокси-серверы в зависимости от настроек сайта. Возможность перегрузки настроек должна присутствовать, так как не везде в проекте нужно использование прокси-сервера.</p>
            
          </div>

          <div class="attachments" id="attachments">
            
              <ul class="issue-attachment-list attachment-list clearfix"
                  data-delete-url="/mst777/zerx_tv/issues/598">
                
                  <li>
                    
                      <a class="attachment-link" title="curl-helper_2016-05-10.txt"
                         href="/mst777/zerx_tv/issues/attachments/598/mst777/zerx_tv/1462914050.01/598/curl-helper_2016-05-10.txt" target="_blank" download="curl-helper_2016-05-10.txt">
                        
                          <span class="placeholder default"></span>
                        
                        <span class="filename">curl-helper_2016-05-10.txt</span>
                      </a>
                    
                    
                      <a data-id="1786108" href="#delete-attachment" title="Delete attachment"><span class="aui-icon aui-icon-small aui-iconfont-remove">Delete attachment</span></a>
                    
                  </li>
                
              </ul>
            
          </div>
        </div>

        <div id="issues-comments-container">
          

          <h2>
            
              Comments (15)
            
          </h2>
          <ol id="issues-comments" class="comments-list commentable">
            
              <li class="issue-comment comment" id="comment-27285687">
                
                 

<article id="comment-27285687" class="iterable-item"
         data-comment-id="27285687"
         data-convert-markup="False"
         
         >
  <header>
      <a href="/icamys/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/icamys/avatar/32/?ts=1505378342" alt="">
          </div>
        </div>
      </a>
      <a href="/icamys/" class="author">Dmitrii Prisacari</a>
      
      <span class="aui-lozenge aui-lozenge-complete aui-lozenge-subtle user-issue-lozenge">reporter</span>
      
  </header>
  <ul class="changes">
      <li>
              edited description
      </li>
  </ul>
  <div class="wiki-content comment-content">
    
  </div>
  <ul class="comment-actions">
    <li>
      <a class="permalink" href="#comment-27285687" title="Link directly to this comment">
        <time datetime="2016-04-26T10:38:39+00:00" data-title="true">2016-04-26T10:38:39+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
              <li class="issue-comment comment" id="comment-27485928">
                
                 

<article id="comment-27485928" class="iterable-item"
         data-comment-id="27485928"
         data-convert-markup="False"
         
         >
  <header>
      <a href="/icamys/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/icamys/avatar/32/?ts=1505378342" alt="">
          </div>
        </div>
      </a>
      <a href="/icamys/" class="author">Dmitrii Prisacari</a>
      
      <span class="aui-lozenge aui-lozenge-complete aui-lozenge-subtle user-issue-lozenge">reporter</span>
      
  </header>
  <ul class="changes">
      <li>
                  marked as <a href="/mst777/zerx_tv/issues?priority=critical">critical</a>
      </li>
      <li>
                marked as <a href="/mst777/zerx_tv/issues?kind=task">task</a>
      </li>
      <li>
              assigned issue to
                  <a href="/mst777/zerx_tv/issues?responsible=icamys" title="Dmitrii Prisacari">
                    <div class="aui-avatar aui-avatar-xsmall">
                      <div class="aui-avatar-inner">
                        <img src="https://bitbucket.org/account/icamys/avatar/32/?ts=1505378342" alt="">
                      </div>
                    </div>
                    <span>Dmitrii Prisacari</span>
                  </a>
      </li>
  </ul>
  <div class="wiki-content comment-content">
    
  </div>
  <ul class="comment-actions">
    <li>
      <a class="permalink" href="#comment-27485928" title="Link directly to this comment">
        <time datetime="2016-05-02T11:15:30+00:00" data-title="true">2016-05-02T11:15:30+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
              <li class="issue-comment comment" id="comment-27493653">
                
                 

<article id="comment-27493653" class="iterable-item"
         data-comment-id="27493653"
         data-convert-markup="False"
         data-content="С неработающими парсерами разобрался. Передаю обратно на выполнение Юре.

Внес 2 значительных коммита: edb1d21 и 485dafd.

В первом провел значительный рефакторинг хелпера Curl, во втором - адаптировал парсеры фильмов и актеров для работы с этим хелпером.

После этих изменений нужно переделать коммиты 6ccb84b, 1847c47, 9f5756c и 0d2b012 начиная с самой последней ревизии девелоперской ветки."
         >
  <header>
      <a href="/icamys/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/icamys/avatar/32/?ts=1505378342" alt="">
          </div>
        </div>
      </a>
      <a href="/icamys/" class="author">Dmitrii Prisacari</a>
      
      <span class="aui-lozenge aui-lozenge-complete aui-lozenge-subtle user-issue-lozenge">reporter</span>
      
  </header>
  <ul class="changes">
      <li>
              assigned issue to
                  <a href="/mst777/zerx_tv/issues?responsible=yybitb" title="yybitb">
                    <div class="aui-avatar aui-avatar-xsmall">
                      <div class="aui-avatar-inner">
                        <img src="https://bitbucket.org/account/yybitb/avatar/32/?ts=1505382991" alt="">
                      </div>
                    </div>
                    <span>yybitb</span>
                  </a>
      </li>
  </ul>
  <div class="wiki-content comment-content">
    <p>С неработающими парсерами разобрался. Передаю обратно на выполнение Юре.</p>
<p>Внес 2 значительных коммита: <a href="/mst777/zerx_tv/commits/edb1d21" rel="nofollow">edb1d21</a> и <a href="/mst777/zerx_tv/commits/485dafd" rel="nofollow">485dafd</a>.</p>
<p>В первом провел значительный рефакторинг хелпера Curl, во втором - адаптировал парсеры фильмов и актеров для работы с этим хелпером.</p>
<p>После этих изменений нужно переделать коммиты <a href="/mst777/zerx_tv/commits/6ccb84b" rel="nofollow">6ccb84b</a>, <a href="/mst777/zerx_tv/commits/1847c47" rel="nofollow">1847c47</a>, <a href="/mst777/zerx_tv/commits/9f5756c" rel="nofollow">9f5756c</a> и <a href="/mst777/zerx_tv/commits/0d2b012" rel="nofollow">0d2b012</a> начиная с самой последней ревизии девелоперской ветки.</p>
  </div>
  <ul class="comment-actions">
    <li>
      <a class="permalink" href="#comment-27493653" title="Link directly to this comment">
        <time datetime="2016-05-02T16:45:56+00:00" data-title="true">2016-05-02T16:45:56+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
              <li class="issue-comment comment" id="comment-27571250">
                
                 

<article id="comment-27571250" class="iterable-item"
         data-comment-id="27571250"
         data-convert-markup="False"
         data-content="Последний комит 20d52fe. Переписал вызов cUrl через новый хелпер везде, кроме: 

* `engine/geo.class.php` - не нашел вызов методов, использующих cUrl из этого модуля .
* `engine/classes/curl/DudeCurl/Adapters/CurlExt.class.php` - неиспользуемый хелпер.
* `engine/editor/jscripts/tiny_mce/plugins/spellchecker/classes/GoogleSpell.php` -  сторонний компонент, но не в папке 'vendors'.
* все компоненты в папке 'vendors'."
         >
  <header>
      <a href="/yybitb/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/yybitb/avatar/32/?ts=1505382991" alt="">
          </div>
        </div>
      </a>
      <a href="/yybitb/" class="author">yybitb</a>
      
      
      
  </header>
  <ul class="changes">
  </ul>
  <div class="wiki-content comment-content">
    <p>Последний комит <a href="/mst777/zerx_tv/commits/20d52fe" rel="nofollow">20d52fe</a>. Переписал вызов cUrl через новый хелпер везде, кроме: </p>
<ul>
<li><code>engine/geo.class.php</code> - не нашел вызов методов, использующих cUrl из этого модуля .</li>
<li><code>engine/classes/curl/DudeCurl/Adapters/CurlExt.class.php</code> - неиспользуемый хелпер.</li>
<li><code>engine/editor/jscripts/tiny_mce/plugins/spellchecker/classes/GoogleSpell.php</code> -  сторонний компонент, но не в папке 'vendors'.</li>
<li>все компоненты в папке 'vendors'.</li>
</ul>
  </div>
  <ul class="comment-actions">
    <li>
      <a href="#edit" class="edit-comment-link">Edit</a>
    </li>
    <li>
      <form method="POST" action="/mst777/zerx_tv/issue/delete/598/27571250">
        <input type='hidden' name='csrfmiddlewaretoken' value='sQXaNviOK7xmeNV0PkhVoA0RB81i8aIG' />
        <a class="delete-link" href="#comment-delete">
          Delete
        </a>
      </form>
    </li>
    <li>
      <a class="permalink" href="#comment-27571250" title="Link directly to this comment">
        <time datetime="2016-05-05T06:53:11+00:00" data-title="true">2016-05-05T06:53:11+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
              <li class="issue-comment comment" id="comment-27580857">
                
                 

<article id="comment-27580857" class="iterable-item"
         data-comment-id="27580857"
         data-convert-markup="False"
         data-content="При тестировании ветки iss598 (последний коммит - 	a9655f6) на сайте preview.zerx.co возникла проблема:

При попытке спарсить фильм (http://www.kinopoisk.ru/film/915351/), получаю ошибку:

![ошибка-создания директории.jpeg](https://bitbucket.org/repo/XKoj4q/images/3623306630-%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B0-%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B4%D0%B8%D1%80%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B8%D0%B8.jpeg)

Предполагаю, что там ошибка создания поддиректории в директории `uploads` (сейчас `uploads` совсем пуста). Этой проблемы возникать не должно."
         >
  <header>
      <a href="/icamys/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/icamys/avatar/32/?ts=1505378342" alt="">
          </div>
        </div>
      </a>
      <a href="/icamys/" class="author">Dmitrii Prisacari</a>
      
      <span class="aui-lozenge aui-lozenge-complete aui-lozenge-subtle user-issue-lozenge">reporter</span>
      
  </header>
  <ul class="changes">
  </ul>
  <div class="wiki-content comment-content">
    <p>При тестировании ветки iss598 (последний коммит -   <a href="/mst777/zerx_tv/commits/a9655f6" rel="nofollow">a9655f6</a>) на сайте preview.zerx.co возникла проблема:</p>
<p>При попытке спарсить фильм (<a href="http://www.kinopoisk.ru/film/915351/" rel="nofollow">http://www.kinopoisk.ru/film/915351/</a>), получаю ошибку:</p>
<p><img alt="ошибка-создания директории.jpeg" src="https://bitbucket.org/repo/XKoj4q/images/3623306630-%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B0-%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%B4%D0%B8%D1%80%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B8%D0%B8.jpeg" /></p>
<p>Предполагаю, что там ошибка создания поддиректории в директории <code>uploads</code> (сейчас <code>uploads</code> совсем пуста). Этой проблемы возникать не должно.</p>
  </div>
  <ul class="comment-actions">
    <li>
      <a class="permalink" href="#comment-27580857" title="Link directly to this comment">
        <time datetime="2016-05-05T13:55:34+00:00" data-title="true">2016-05-05T13:55:34+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
              <li class="issue-comment comment" id="comment-27601914">
                
                 

<article id="comment-27601914" class="iterable-item"
         data-comment-id="27601914"
         data-convert-markup="False"
         data-content="Возникла еще одна проблема, связанная с CURL.

Воспроизводится на preview.zerx.co:

+ Переходим на страницу с граббером: http://preview.zerx.co/admin_zerx.php?mod=grabber
+ Справа от &quot;Завершено 0/&quot; жмем на &quot;=&gt;&quot;, откроется страница с файлом
+ Выбираем файл и нашимаем  &quot;загрузить выбранное&quot;.
+ Получаем пустую страницу

В логах получил следующее сообщение:

```
PHP message: PHP Fatal error:  Allowed memory size of 67108864 bytes exhausted (tried to allocate 62923793 bytes) 
in /usr/home/zerx/www-preview/vendor/php-curl-class/php-curl-class/src/Curl/Curl.php on line 344&quot; 
while reading response header from upstream,
client: 89.28.43.249,
server: www.preview.zerx.co,
request: &quot;POST /admin_zerx.php?mod=grabber HTTP/1.1&quot;,
upstream: &quot;fastcgi://unix:/var/run/fpm.d/main.sock:&quot;,
host: &quot;preview.zerx.co&quot;,
referrer: &quot;http://preview.zerx.co/admin_zerx.php?mod=grabber&quot;
```"
         >
  <header>
      <a href="/icamys/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/icamys/avatar/32/?ts=1505378342" alt="">
          </div>
        </div>
      </a>
      <a href="/icamys/" class="author">Dmitrii Prisacari</a>
      
      <span class="aui-lozenge aui-lozenge-complete aui-lozenge-subtle user-issue-lozenge">reporter</span>
      
  </header>
  <ul class="changes">
  </ul>
  <div class="wiki-content comment-content">
    <p>Возникла еще одна проблема, связанная с CURL.</p>
<p>Воспроизводится на preview.zerx.co:</p>
<ul>
<li>Переходим на страницу с граббером: <a href="http://preview.zerx.co/admin_zerx.php?mod=grabber" rel="nofollow">http://preview.zerx.co/admin_zerx.php?mod=grabber</a></li>
<li>Справа от "Завершено 0/" жмем на "=&gt;", откроется страница с файлом</li>
<li>Выбираем файл и нашимаем  "загрузить выбранное".</li>
<li>Получаем пустую страницу</li>
</ul>
<p>В логах получил следующее сообщение:</p>
<div class="codehilite"><pre><span></span>PHP message: PHP Fatal error:  Allowed memory size of 67108864 bytes exhausted (tried to allocate 62923793 bytes) 
in /usr/home/zerx/www-preview/vendor/php-curl-class/php-curl-class/src/Curl/Curl.php on line 344&quot; 
while reading response header from upstream,
client: 89.28.43.249,
server: www.preview.zerx.co,
request: &quot;POST /admin_zerx.php?mod=grabber HTTP/1.1&quot;,
upstream: &quot;fastcgi://unix:/var/run/fpm.d/main.sock:&quot;,
host: &quot;preview.zerx.co&quot;,
referrer: &quot;http://preview.zerx.co/admin_zerx.php?mod=grabber&quot;
</pre></div>
  </div>
  <ul class="comment-actions">
    <li>
      <a class="permalink" href="#comment-27601914" title="Link directly to this comment">
        <time datetime="2016-05-06T11:15:19+00:00" data-title="true">2016-05-06T11:15:19+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
              <li class="issue-comment comment" id="comment-27624072">
                
                 

<article id="comment-27624072" class="iterable-item"
         data-comment-id="27624072"
         data-convert-markup="False"
         data-content="Пока не обнаружил где именно суть проблемы. однако есть **рабочий** вариант на комите 272f6fba004cf4b3952e285fa83ec6f8ed5e6021 (новый хелпер + timeout == 4 sec) и еще 1 **рабочий** вариант на комите 6b3ffd48515604ea5a0a9e31c7c86aa7169ff2f2 (фрагмент старого кода с timeout == 15 sec)"
         >
  <header>
      <a href="/yybitb/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/yybitb/avatar/32/?ts=1505382991" alt="">
          </div>
        </div>
      </a>
      <a href="/yybitb/" class="author">yybitb</a>
      
      
      
  </header>
  <ul class="changes">
  </ul>
  <div class="wiki-content comment-content">
    <p>Пока не обнаружил где именно суть проблемы. однако есть <strong>рабочий</strong> вариант на комите <a href="/mst777/zerx_tv/commits/272f6fba004cf4b3952e285fa83ec6f8ed5e6021" rel="nofollow">272f6fba004cf4b3952e285fa83ec6f8ed5e6021</a> (новый хелпер + timeout == 4 sec) и еще 1 <strong>рабочий</strong> вариант на комите <a href="/mst777/zerx_tv/commits/6b3ffd48515604ea5a0a9e31c7c86aa7169ff2f2" rel="nofollow">6b3ffd48515604ea5a0a9e31c7c86aa7169ff2f2</a> (фрагмент старого кода с timeout == 15 sec)</p>
  </div>
  <ul class="comment-actions">
    <li>
      <a href="#edit" class="edit-comment-link">Edit</a>
    </li>
    <li>
      <form method="POST" action="/mst777/zerx_tv/issue/delete/598/27624072">
        <input type='hidden' name='csrfmiddlewaretoken' value='sQXaNviOK7xmeNV0PkhVoA0RB81i8aIG' />
        <a class="delete-link" href="#comment-delete">
          Delete
        </a>
      </form>
    </li>
    <li>
      <a class="permalink" href="#comment-27624072" title="Link directly to this comment">
        <time datetime="2016-05-07T15:59:29+00:00" data-title="true">2016-05-07T15:59:29+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
              <li class="issue-comment comment" id="comment-27643477">
                
                 

<article id="comment-27643477" class="iterable-item"
         data-comment-id="27643477"
         data-convert-markup="False"
         data-content="```
#!text

[08.05.2016 19:31:28] Dmitrii Prisacari [php Kvertix]: так и не понял, что было сделано кроме уменьшения таймаута. Убери, пожалуйста, лишние коммиты после e5e620f, чтобы в одном коммите были видны сразу все изменения и прокомментируй их,
```

Сделал комит 19ab325: Это e5e620f + новый ключ из комита 516ed8d + использование оригинального компонента `\Curl\Curl()` c подстановкой прокси из старой функции get_proxy() только в блоке $_POST['action'] == 'start_loading' `engine/inc/grabber.php:130`

Предыдущие комиты не убирал, тк не смог найти баг в новом хелпере касательно ошибки cUrl, вероятно они помогут ее все-таки отыскать. "
         >
  <header>
      <a href="/yybitb/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/yybitb/avatar/32/?ts=1505382991" alt="">
          </div>
        </div>
      </a>
      <a href="/yybitb/" class="author">yybitb</a>
      
      
      
  </header>
  <ul class="changes">
  </ul>
  <div class="wiki-content comment-content">
    <div class="codehilite language-text"><pre><span></span>[08.05.2016 19:31:28] Dmitrii Prisacari [php Kvertix]: так и не понял, что было сделано кроме уменьшения таймаута. Убери, пожалуйста, лишние коммиты после e5e620f, чтобы в одном коммите были видны сразу все изменения и прокомментируй их,
</pre></div>


<p>Сделал комит <a href="/mst777/zerx_tv/commits/19ab325" rel="nofollow">19ab325</a>: Это <a href="/mst777/zerx_tv/commits/e5e620f" rel="nofollow">e5e620f</a> + новый ключ из комита <a href="/mst777/zerx_tv/commits/516ed8d" rel="nofollow">516ed8d</a> + использование оригинального компонента <code>\Curl\Curl()</code> c подстановкой прокси из старой функции get_proxy() только в блоке $_POST['action'] == 'start_loading' <code>engine/inc/grabber.php:130</code></p>
<p>Предыдущие комиты не убирал, тк не смог найти баг в новом хелпере касательно ошибки cUrl, вероятно они помогут ее все-таки отыскать. </p>
  </div>
  <ul class="comment-actions">
    <li>
      <a href="#edit" class="edit-comment-link">Edit</a>
    </li>
    <li>
      <form method="POST" action="/mst777/zerx_tv/issue/delete/598/27643477">
        <input type='hidden' name='csrfmiddlewaretoken' value='sQXaNviOK7xmeNV0PkhVoA0RB81i8aIG' />
        <a class="delete-link" href="#comment-delete">
          Delete
        </a>
      </form>
    </li>
    <li>
      <a class="permalink" href="#comment-27643477" title="Link directly to this comment">
        <time datetime="2016-05-09T07:20:38+00:00" data-title="true">2016-05-09T07:20:38+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
              <li class="issue-comment comment" id="comment-27675412">
                
                 

<article id="comment-27675412" class="iterable-item"
         data-comment-id="27675412"
         data-convert-markup="False"
         data-content="нашли новую проблему в граббере (видимо, следующий этап работы граббера):

При добавлении нового сериала на скачивание мы жмем на ссылку &quot;Добавить новый (сериал/фильм)&quot;, заполняем поля

Данные для теста: 
URL: http://seasonvar.ru/serial-5638-Reklamnaya_pauza.html

News(id): 63706

Отправляем запрос. получаем пустой ответ http://joxi.ru/J2b6J54u4J7vV2

Что ожидается - http://joxi.ru/eAOL54eS4RP7Wr"
         >
  <header>
      <a href="/icamys/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/icamys/avatar/32/?ts=1505378342" alt="">
          </div>
        </div>
      </a>
      <a href="/icamys/" class="author">Dmitrii Prisacari</a>
      
      <span class="aui-lozenge aui-lozenge-complete aui-lozenge-subtle user-issue-lozenge">reporter</span>
      
  </header>
  <ul class="changes">
  </ul>
  <div class="wiki-content comment-content">
    <p>нашли новую проблему в граббере (видимо, следующий этап работы граббера):</p>
<p>При добавлении нового сериала на скачивание мы жмем на ссылку "Добавить новый (сериал/фильм)", заполняем поля</p>
<p>Данные для теста: 
URL: <a href="http://seasonvar.ru/serial-5638-Reklamnaya_pauza.html" rel="nofollow">http://seasonvar.ru/serial-5638-Reklamnaya_pauza.html</a></p>
<p>News(id): 63706</p>
<p>Отправляем запрос. получаем пустой ответ <a href="http://joxi.ru/J2b6J54u4J7vV2" rel="nofollow">http://joxi.ru/J2b6J54u4J7vV2</a></p>
<p>Что ожидается - <a href="http://joxi.ru/eAOL54eS4RP7Wr" rel="nofollow">http://joxi.ru/eAOL54eS4RP7Wr</a></p>
  </div>
  <ul class="comment-actions">
    <li>
      <a class="permalink" href="#comment-27675412" title="Link directly to this comment">
        <time datetime="2016-05-10T09:12:04+00:00" data-title="true">2016-05-10T09:12:04+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
              <li class="issue-comment comment" id="comment-27682251">
                
                 

<article id="comment-27682251" class="iterable-item"
         data-comment-id="27682251"
         data-convert-markup="False"
         data-content="Следующий баг:

http://preview.zerx.co/admin_zerx.php?mod=grabber&amp;flag=n2

находим в списке &quot;Легенда о четырех Стражах Tae Wang Sa Shin Gi&quot; - жмем напротив &quot;=&gt;&quot;, открывается страница с сериями

http://joxi.ru/v29L7JOSGnyPVm выбираем 1 серию и жмем кнопку

после нажатия кнопки перенаправляет на пустую страницу, а должно этот сериал поднять в верх в списке и серия добавить на скачивание"
         >
  <header>
      <a href="/icamys/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/icamys/avatar/32/?ts=1505378342" alt="">
          </div>
        </div>
      </a>
      <a href="/icamys/" class="author">Dmitrii Prisacari</a>
      
      <span class="aui-lozenge aui-lozenge-complete aui-lozenge-subtle user-issue-lozenge">reporter</span>
      
  </header>
  <ul class="changes">
  </ul>
  <div class="wiki-content comment-content">
    <p>Следующий баг:</p>
<p><a href="http://preview.zerx.co/admin_zerx.php?mod=grabber&amp;flag=n2" rel="nofollow">http://preview.zerx.co/admin_zerx.php?mod=grabber&amp;flag=n2</a></p>
<p>находим в списке "Легенда о четырех Стражах Tae Wang Sa Shin Gi" - жмем напротив "=&gt;", открывается страница с сериями</p>
<p><a href="http://joxi.ru/v29L7JOSGnyPVm" rel="nofollow">http://joxi.ru/v29L7JOSGnyPVm</a> выбираем 1 серию и жмем кнопку</p>
<p>после нажатия кнопки перенаправляет на пустую страницу, а должно этот сериал поднять в верх в списке и серия добавить на скачивание</p>
  </div>
  <ul class="comment-actions">
    <li>
      <a class="permalink" href="#comment-27682251" title="Link directly to this comment">
        <time datetime="2016-05-10T11:58:18+00:00" data-title="true">2016-05-10T11:58:18+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
              <li class="issue-comment comment" id="comment-27685565">
                
                 

<article id="comment-27685565" class="iterable-item"
         data-comment-id="27685565"
         data-convert-markup="False"
         data-content="Сделал комит c18e92f  - принудительное использ. прокси без проверки типа видео на `engine/inc/grabber.php:179`. Пока только предположение что get() с серверного IP ведет в превышению memory_limit"
         >
  <header>
      <a href="/yybitb/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/yybitb/avatar/32/?ts=1505382991" alt="">
          </div>
        </div>
      </a>
      <a href="/yybitb/" class="author">yybitb</a>
      
      
      
  </header>
  <ul class="changes">
  </ul>
  <div class="wiki-content comment-content">
    <p>Сделал комит <a href="/mst777/zerx_tv/commits/c18e92f" rel="nofollow">c18e92f</a>  - принудительное использ. прокси без проверки типа видео на <code>engine/inc/grabber.php:179</code>. Пока только предположение что get() с серверного IP ведет в превышению memory_limit</p>
  </div>
  <ul class="comment-actions">
    <li>
      <a href="#edit" class="edit-comment-link">Edit</a>
    </li>
    <li>
      <form method="POST" action="/mst777/zerx_tv/issue/delete/598/27685565">
        <input type='hidden' name='csrfmiddlewaretoken' value='sQXaNviOK7xmeNV0PkhVoA0RB81i8aIG' />
        <a class="delete-link" href="#comment-delete">
          Delete
        </a>
      </form>
    </li>
    <li>
      <a class="permalink" href="#comment-27685565" title="Link directly to this comment">
        <time datetime="2016-05-10T13:49:32+00:00" data-title="true">2016-05-10T13:49:32+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
              <li class="issue-comment comment" id="comment-27696059">
                
                 

<article id="comment-27696059" class="iterable-item"
         data-comment-id="27696059"
         data-convert-markup="False"
         data-content="Стало понятно, почему так долго работает скрипт и как возникала утечка памяти.

В коммите 5154992 добавил ведение логов. Включается при указании параметра 'debug'.

В коммите b59a2ae сократил количество попыток проверить прокси-сервер до двух, а в 2abba99  время ожидания ответа от сервара в граббере уменьшил до 2 сек.

По логам (см. прикрепленный файл) видно, что для получения видео по ссылке http://data13-cdn.datalock.ru/fi2lm/dba9df86cae4813ac3ca6400fff7d45d/7f_Vetnam.do.voctrebovania.1.seriya.iz.10.1987.XviD.DVDRip.ExKinoRay.a1.05.08.14.mp4  (строка 9) идет успешный перебор прокси-серверов. 

При проверке первого сервера возникают curl ошибки (строки 16 и 19).

А вот при проверке второго сервера уже получаем приемлемый ответ с HTTP кодом 404 (строка 28). Хелпер ошибочно продолжает перебирать серверы, вместо того, чтобы при получении первой же HTTP ошибки завершить работу.

Это поведение исправил коммитом 1b560ef. После него хелпер при возникновении HTTP ошибки должен прекращать перебор прокси-серверов. (не проверял)

Остается выяснить, почему был получен 404 код, возможно код как-то по функциональности разнится с мастер-веткой."
         >
  <header>
      <a href="/icamys/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/icamys/avatar/32/?ts=1505378342" alt="">
          </div>
        </div>
      </a>
      <a href="/icamys/" class="author">Dmitrii Prisacari</a>
      
      <span class="aui-lozenge aui-lozenge-complete aui-lozenge-subtle user-issue-lozenge">reporter</span>
      
  </header>
  <ul class="changes">
      <li>
          attached <a class="attachment" href="/mst777/zerx_tv/issues/attachments/598/mst777/zerx_tv/1462914050.01/598/curl-helper_2016-05-10.txt">curl-helper_2016-05-10.txt</a>
      </li>
  </ul>
  <div class="wiki-content comment-content">
    <p>Стало понятно, почему так долго работает скрипт и как возникала утечка памяти.</p>
<p>В коммите <a href="/mst777/zerx_tv/commits/5154992" rel="nofollow">5154992</a> добавил ведение логов. Включается при указании параметра 'debug'.</p>
<p>В коммите <a href="/mst777/zerx_tv/commits/b59a2ae" rel="nofollow">b59a2ae</a> сократил количество попыток проверить прокси-сервер до двух, а в <a href="/mst777/zerx_tv/commits/2abba99" rel="nofollow">2abba99</a>  время ожидания ответа от сервара в граббере уменьшил до 2 сек.</p>
<p>По логам (см. прикрепленный файл) видно, что для получения видео по ссылке <a href="http://data13-cdn.datalock.ru/fi2lm/dba9df86cae4813ac3ca6400fff7d45d/7f_Vetnam.do.voctrebovania.1.seriya.iz.10.1987.XviD.DVDRip.ExKinoRay.a1.05.08.14.mp4" rel="nofollow">http://data13-cdn.datalock.ru/fi2lm/dba9df86cae4813ac3ca6400fff7d45d/7f_Vetnam.do.voctrebovania.1.seriya.iz.10.1987.XviD.DVDRip.ExKinoRay.a1.05.08.14.mp4</a>  (строка 9) идет успешный перебор прокси-серверов. </p>
<p>При проверке первого сервера возникают curl ошибки (строки 16 и 19).</p>
<p>А вот при проверке второго сервера уже получаем приемлемый ответ с HTTP кодом 404 (строка 28). Хелпер ошибочно продолжает перебирать серверы, вместо того, чтобы при получении первой же HTTP ошибки завершить работу.</p>
<p>Это поведение исправил коммитом <a href="/mst777/zerx_tv/commits/1b560ef" rel="nofollow">1b560ef</a>. После него хелпер при возникновении HTTP ошибки должен прекращать перебор прокси-серверов. (не проверял)</p>
<p>Остается выяснить, почему был получен 404 код, возможно код как-то по функциональности разнится с мастер-веткой.</p>
  </div>
  <ul class="comment-actions">
    <li>
      <a class="permalink" href="#comment-27696059" title="Link directly to this comment">
        <time datetime="2016-05-10T21:00:50+00:00" data-title="true">2016-05-10T21:00:50+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
              <li class="issue-comment comment" id="comment-27706105">
                
                 

<article id="comment-27706105" class="iterable-item"
         data-comment-id="27706105"
         data-convert-markup="False"
         data-content="Касательно 404 кода в ветке 'start_loading' (`engine/inc/grabber.php:134`) - эта ошибка локально исправляется принудительным использованием прокси в том месте где идет проверка типа видео (см. коммент выше)."
         >
  <header>
      <a href="/yybitb/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/yybitb/avatar/32/?ts=1505382991" alt="">
          </div>
        </div>
      </a>
      <a href="/yybitb/" class="author">yybitb</a>
      
      
      
  </header>
  <ul class="changes">
  </ul>
  <div class="wiki-content comment-content">
    <p>Касательно 404 кода в ветке 'start_loading' (<code>engine/inc/grabber.php:134</code>) - эта ошибка локально исправляется принудительным использованием прокси в том месте где идет проверка типа видео (см. коммент выше).</p>
  </div>
  <ul class="comment-actions">
    <li>
      <a href="#edit" class="edit-comment-link">Edit</a>
    </li>
    <li>
      <form method="POST" action="/mst777/zerx_tv/issue/delete/598/27706105">
        <input type='hidden' name='csrfmiddlewaretoken' value='sQXaNviOK7xmeNV0PkhVoA0RB81i8aIG' />
        <a class="delete-link" href="#comment-delete">
          Delete
        </a>
      </form>
    </li>
    <li>
      <a class="permalink" href="#comment-27706105" title="Link directly to this comment">
        <time datetime="2016-05-11T08:29:34+00:00" data-title="true">2016-05-11T08:29:34+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
              <li class="issue-comment comment" id="comment-27720462">
                
                 

<article id="comment-27720462" class="iterable-item"
         data-comment-id="27720462"
         data-convert-markup="False"
         data-content="Судя по всему, проблемы возникают только с граббером. Чтобы не гадать, почему он не работает, подойдем к вопросу с другой стороны:

1. Я еще доработаю хелпер CURL в рамках задачи;
2. Граббер оставляем точно таким-же как в мастер-ветке (с вызовом функций curl напрямую), чтобы он продолжал работать;
3. Заканчиваем и отлаживаем страницу создания/редактирования фильма (#443);
4. Полностью переписываем граббер (#613);
5. Заканчиваем рефакторинг CURL уже в переписанном граббере."
         >
  <header>
      <a href="/icamys/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/icamys/avatar/32/?ts=1505378342" alt="">
          </div>
        </div>
      </a>
      <a href="/icamys/" class="author">Dmitrii Prisacari</a>
      
      <span class="aui-lozenge aui-lozenge-complete aui-lozenge-subtle user-issue-lozenge">reporter</span>
      
  </header>
  <ul class="changes">
  </ul>
  <div class="wiki-content comment-content">
    <p>Судя по всему, проблемы возникают только с граббером. Чтобы не гадать, почему он не работает, подойдем к вопросу с другой стороны:</p>
<ol>
<li>Я еще доработаю хелпер CURL в рамках задачи;</li>
<li>Граббер оставляем точно таким-же как в мастер-ветке (с вызовом функций curl напрямую), чтобы он продолжал работать;</li>
<li>Заканчиваем и отлаживаем страницу создания/редактирования фильма (<a href="/mst777/zerx_tv/issues/443/---------------------------------------" rel="nofollow" title="Обновить страницу редактирования фильма"><s>#443</s></a>);</li>
<li>Полностью переписываем граббер (<a href="/mst777/zerx_tv/issues/613/--------------------" rel="nofollow" title="Рефакторинг граббера"><s>#613</s></a>);</li>
<li>Заканчиваем рефакторинг CURL уже в переписанном граббере.</li>
</ol>
  </div>
  <ul class="comment-actions">
    <li>
      <a class="permalink" href="#comment-27720462" title="Link directly to this comment">
        <time datetime="2016-05-11T16:55:09+00:00" data-title="true">2016-05-11T16:55:09+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
              <li class="issue-comment comment" id="comment-28413954">
                
                 

<article id="comment-28413954" class="iterable-item"
         data-comment-id="28413954"
         data-convert-markup="False"
         data-content="Задачу с рефакторингом граббера #613 довели до этапа позднего тестирования. Если никаких ошибок не обнаружим, удалим старый модуль и закроем задачу.

Рефакторинг curl закончили."
         >
  <header>
      <a href="/icamys/">
        <div class="aui-avatar aui-avatar-medium">
          <div class="aui-avatar-inner">
            <img src="https://bitbucket.org/account/icamys/avatar/32/?ts=1505378342" alt="">
          </div>
        </div>
      </a>
      <a href="/icamys/" class="author">Dmitrii Prisacari</a>
      
      <span class="aui-lozenge aui-lozenge-complete aui-lozenge-subtle user-issue-lozenge">reporter</span>
      
  </header>
  <ul class="changes">
      <li>
                    changed status to
                    <a href="/mst777/zerx_tv/issues?status=resolved">resolved</a>
      </li>
  </ul>
  <div class="wiki-content comment-content">
    <p>Задачу с рефакторингом граббера <a href="/mst777/zerx_tv/issues/613/--------------------" rel="nofollow" title="Рефакторинг граббера"><s>#613</s></a> довели до этапа позднего тестирования. Если никаких ошибок не обнаружим, удалим старый модуль и закроем задачу.</p>
<p>Рефакторинг curl закончили.</p>
  </div>
  <ul class="comment-actions">
    <li>
      <a class="permalink" href="#comment-28413954" title="Link directly to this comment">
        <time datetime="2016-06-10T08:50:32+00:00" data-title="true">2016-06-10T08:50:32+00:00</time>
      </a>
    </li>
  </ul>
</article>

              </li>
            
            
          </ol>
          
            
            
              
    
    
  
            
          
        </div>
      </div>
      <div class="aui-item sidebar">
        <div class="issue-attrs">
          <dl>
            <dt>Assignee</dt>
            <dd class="assignee with-icon">
              
                <a href="/mst777/zerx_tv/issues?responsible=yybitb">
                  <span class="aui-avatar aui-avatar-xsmall">
                    <span class="aui-avatar-inner">
                      <img src="https://bitbucket.org/account/yybitb/avatar/16/?ts=1505382991">
                    </span>
                  </span>
                  yybitb
                </a>
              
            </dd>
          </dl>
          <dl>
            <dt>Type</dt>
            <dd class="type with-icon">
              <a href="/mst777/zerx_tv/issues?kind=task">
                <span class="icon icon-task"></span>
                task
              </a>
            </dd>
          </dl>
          <dl>
            <dt>Priority</dt>
            <dd class="priority with-icon">
              <a href="/mst777/zerx_tv/issues?priority=critical">
                <span class="icon icon-critical"></span>
                critical
              </a>
            </dd>
          </dl>
          <dl>
            <dt>Status</dt>
            <dd class="status">
              <a href="/mst777/zerx_tv/issues?status=resolved">
                resolved
              </a>
            </dd>
          </dl>
          
          
          
          <dl>
            <dt>Votes</dt>
            <dd class="votes">
              <span id="issue-vote-count" class="aui-badge">0</span>
              
                <a href="/api/1.0/repositories/mst777/zerx_tv/issue/598/vote"
                   id="issue-vote-trigger" class="vote-issue"
                   data-vote-text="Vote for this issue"
                   data-unvote-text="Remove vote"
                   
                     data-voted="false"
                     title="Vote for this issue"> Vote for this issue
                   
                </a>
              
            </dd>
          </dl>
          <dl>
            <dt>Watchers</dt>
            <dd class="watchers">
              <span id="issue-watch-count" class="aui-badge aui-badge-active">2</span>
              
                <a href="/api/1.0/repositories/mst777/zerx_tv/issue/598/follow"
                   id="issue-watch-trigger"
                   class="follow-issue follow following"
                   data-follow-text="Watch this issue"
                   data-unfollow-text="Stop watching"
                    
                   title="Stop watching this issue"> Stop watching
                    
                </a>
              
            </dd>
          </dl>
        </div>
        
          
            
          
        
      </div>
    </div>
  </section>

  </div>

        
        
        
          
    
    
  
        
      </div>
    </div>
    <div id="code-search-cta"></div>
  </div>

      </div>
    </div>
  

  
</div>

  <div id="adg3-dialog"></div>



  

<div data-module="components/mentions/index">
  
    
    
  
  
    
    
  
  
    
    
  
</div>
<div data-module="components/typeahead/emoji/index">
  
    
    
  
</div>

<div data-module="components/repo-typeahead/index">
  
    
    
  
</div>

    
    
  

    
    
  

    
    
  

    
    
  


  <aui-inline-dialog
    id="help-menu-dialog"
    data-aui-alignment="bottom right"

    
    data-aui-alignment-static="true"
    data-module="header/help-menu"
    responds-to="toggle"
    aria-hidden="true">

  <div id="help-menu-section">
    <h1 class="help-menu-heading">Help</h1>

    <form id="help-menu-search-form" class="aui" target="_blank" method="get"
        action="https://support.atlassian.com/customer/search">
      <span id="help-menu-search-icon" class="aui-icon aui-icon-large aui-iconfont-search"></span>
      <input id="help-menu-search-form-input" name="q" class="text" type="text" placeholder="Ask a question">
    </form>

    <ul id="help-menu-links">
      <li>
        <a class="support-ga" data-support-gaq-page="DocumentationHome"
            href="https://confluence.atlassian.com/x/bgozDQ" target="_blank">
          Online help
        </a>
      </li>
      <li>
        <a class="support-ga" data-support-gaq-page="GitTutorials"
            href="https://www.atlassian.com/git?utm_source=bitbucket&amp;utm_medium=link&amp;utm_campaign=help_dropdown&amp;utm_content=learn_git"
            target="_blank">
          Learn Git
        </a>
      </li>
      <li>
        <a id="keyboard-shortcuts-link"
           href="#">Keyboard shortcuts</a>
      </li>
      <li>
        <a class="support-ga" data-support-gaq-page="DocumentationTutorials"
            href="https://confluence.atlassian.com/x/Q4sFLQ" target="_blank">
          Bitbucket tutorials
        </a>
      </li>
      <li>
        <a class="support-ga" data-support-gaq-page="SiteStatus"
            href="https://status.bitbucket.org/" target="_blank">
          Site status
        </a>
      </li>
      <li>
        <a class="support-ga" data-support-gaq-page="Home"
            href="https://support.atlassian.com/bitbucket-cloud/" target="_blank">
          Support
        </a>
      </li>
    </ul>
  </div>
</aui-inline-dialog>
  


  <div class="omnibar" data-module="components/omnibar/index">
    <form class="omnibar-form aui"></form>
  </div>
  
    
    
  
  
    
    
  
  
    
    
  
  
    
    
  




  

  <div class="_mustache-templates">
    
      <script id="transition-dialog-template" type="text/html">
        

<form class="aui" id="issue-transition-form" method="post"
            data-duplicate-url="/mst777/zerx_tv/issue-duplicate/598/">
  <div class="aui-message error hidden">
    <span class="aui-icon icon-error"></span>
    <div class="message"></div>
  </div>

  <div class=" duplicate field-group">
    <label for="id_duplicate_issue">Issue number</label>
    <input type="text" class="text" id="id_duplicate_issue"/>
  </div>
  <div class="comment field-group">
    <label for="id_transition_comment">Comment</label>
    <div class="textarea-preview">
       <textarea id="id_transition_comment" class="bb-mention-input"
          data-mention-url="/xhr/mentions/repositories/mst777/zerx_tv/issues"
          ></textarea>
       <div class="preview-container wiki-content"><!-- loaded via ajax --></div>
       <div class="mask"></div>
    </div>
  </div>
</form>

      </script>
    
      <script id="user-select-template" type="text/html">
        

<div class="aui-avatar aui-avatar-xsmall admin-avatar">
  <div class="aui-avatar-inner">
    <img src="[[avatar]]">
  </div>
</div>
<span>[[display_name]]</span>

      </script>
    
      <script id="attachment-dialog-template" type="text/html">
        

<form class="aui" id="issue-attachment-form" method="post"
      enctype="multipart/form-data"
      action="/mst777/zerx_tv/issue-attachment/598/">
  <div class="aui-message error hidden">
    <span class="aui-icon icon-error"></span>
    <div class="message"></div>
  </div>
  <input type='hidden' name='csrfmiddlewaretoken' value='sQXaNviOK7xmeNV0PkhVoA0RB81i8aIG' />
  <div class="attachment field-group">
    <label for="id_attachments">Attachments</label>
    <input type="file" multiple="multiple" name="attachments" id="id_attachments">
  </div>
  <div class="comment field-group">
    <label for="id_attachment_comment">Comment</label>
    <div class="textarea-preview">
      <textarea id="id_attachment_comment" name="update_comment"/>
      <div class="preview-container wiki-content"><!-- loaded via ajax --></div>
      <div class="mask"></div>
    </div>
  </div>
</form>

      </script>
    
      <script id="new-comment-template" type="text/html">
        
<li class="new-comment">
  <div class="user">
    <div class="aui-avatar aui-avatar-medium">
      <div class="aui-avatar-inner">
        <img src="[[user_avatar_url]]" alt="" />
      </div>
    </div>
  </div>
  <form class="aui top-label editor" action="#">
    <input type="hidden" class="parent_id"/>
    <input type="hidden" class="comment_id"/>
    [[#convert_markup]]
      <div class="warning aui-message convert-markup">
        <span class="aui-icon icon-warning"></span>
        
        This comment is currently being rendered in creole. Editing the comment will cause it to be rendered in <a target="_blank" href="https://confluence.atlassian.com/x/jIAuEg">markdown</a>.
        
      </div>
    [[/convert_markup]]
    <div class="field-group">
      <textarea id="id_new_comment" class="bb-mention-input"
          
          placeholder="What do you want to say?">[[content]]</textarea>
      <div class="preview-container wiki-content"><!-- loaded via ajax --></div>
      <div class="error"></div>
    </div>
    <div class="buttons">
      <button class="aui-button aui-button-primary js-comment-button" type="submit">Comment</button>
      <a href="#" class="cancel">Cancel</a>
      
    </div>
    <div class="mask"></div>
  </form>
</li>

      </script>
    
      <script id="image-upload-template" type="text/html">
        

<form id="upload-image" method="POST"
    
      action="/xhr/mst777/zerx_tv/image-upload/"
    >
  <input type='hidden' name='csrfmiddlewaretoken' value='sQXaNviOK7xmeNV0PkhVoA0RB81i8aIG' />

  <div class="drop-target">
    <p class="centered">Drag image here</p>
  </div>

  
  <div>
    <button class="aui-button click-target">Select an image</button>
    <input name="file" type="file" class="hidden file-target"
           accept="image/jpeg, image/gif, image/png" />
    <input type="submit" class="hidden">
  </div>
</form>


      </script>
    
      <script id="mention-result" type="text/html">
        
<span class="mention-result">
  <span class="aui-avatar aui-avatar-small mention-result--avatar">
    <span class="aui-avatar-inner">
      <img src="[[avatar_url]]">
    </span>
  </span>
  [[#display_name]]
    <span class="display-name mention-result--display-name">[[&display_name]]</span> <small class="username mention-result--username">[[&username]]</small>
  [[/display_name]]
  [[^display_name]]
    <span class="username mention-result--username">[[&username]]</span>
  [[/display_name]]
  [[#is_teammate]][[^is_team]]
    <span class="aui-lozenge aui-lozenge-complete aui-lozenge-subtle mention-result--lozenge">teammate</span>
  [[/is_team]][[/is_teammate]]
</span>
      </script>
    
      <script id="mention-call-to-action" type="text/html">
        
[[^query]]
<li class="bb-typeahead-item">Begin typing to search for a user</li>
[[/query]]
[[#query]]
<li class="bb-typeahead-item">Continue typing to search for a user</li>
[[/query]]

      </script>
    
      <script id="mention-no-results" type="text/html">
        
[[^searching]]
<li class="bb-typeahead-item">Found no matching users for <em>[[query]]</em>.</li>
[[/searching]]
[[#searching]]
<li class="bb-typeahead-item bb-typeahead-searching">Searching for <em>[[query]]</em>.</li>
[[/searching]]

      </script>
    
      <script id="emoji-result" type="text/html">
        
<span class="emoji-result">
  <span class="emoji-result--avatar">
    <img class="emoji" src="[[src]]">
  </span>
  <span class="name emoji-result--name">[[&name]]</span>
</span>

      </script>
    
      <script id="repo-typeahead-result" type="text/html">
        <span class="aui-avatar aui-avatar-project aui-avatar-xsmall">
  <span class="aui-avatar-inner">
    <img src="[[avatar]]">
  </span>
</span>
<span class="owner">[[&owner]]</span>/<span class="slug">[[&slug]]</span>

      </script>
    
      <script id="share-form-template" type="text/html">
        

<div class="error aui-message hidden">
  <span class="aui-icon icon-error"></span>
  <div class="message"></div>
</div>
<form class="aui">
  <table class="widget bb-list aui">
    <thead>
    <tr class="assistive">
      <th class="user">User</th>
      <th class="role">Role</th>
      <th class="actions">Actions</th>
    </tr>
    </thead>
    <tbody>
      <tr class="form">
        <td colspan="2">
          <input type="text" class="text bb-user-typeahead user-or-email"
                 placeholder="Username or email address"
                 autocomplete="off"
                 data-bb-typeahead-focus="false"
                 [[#disabled]]disabled[[/disabled]]>
        </td>
        <td class="actions">
          <button type="submit" class="aui-button aui-button-light" disabled>Add</button>
        </td>
      </tr>
    </tbody>
  </table>
</form>

      </script>
    
      <script id="share-detail-template" type="text/html">
        

[[#username]]
<td class="user
    [[#hasCustomGroups]]custom-groups[[/hasCustomGroups]]"
    [[#error]]data-error="[[error]]"[[/error]]>
  <div title="[[displayName]]">
    <a href="/[[username]]/" class="user">
      <span class="aui-avatar aui-avatar-xsmall">
        <span class="aui-avatar-inner">
          <img src="[[avatar]]">
        </span>
      </span>
      <span>[[displayName]]</span>
    </a>
  </div>
</td>
[[/username]]
[[^username]]
<td class="email
    [[#hasCustomGroups]]custom-groups[[/hasCustomGroups]]"
    [[#error]]data-error="[[error]]"[[/error]]>
  <div title="[[email]]">
    <span class="aui-icon aui-icon-small aui-iconfont-email"></span>
    [[email]]
  </div>
</td>
[[/username]]
<td class="role
    [[#hasCustomGroups]]custom-groups[[/hasCustomGroups]]">
  <div>
    [[#group]]
      [[#hasCustomGroups]]
        <select class="group [[#noGroupChoices]]hidden[[/noGroupChoices]]">
          [[#groups]]
            <option value="[[slug]]"
                [[#isSelected]]selected[[/isSelected]]>
              [[name]]
            </option>
          [[/groups]]
        </select>
      [[/hasCustomGroups]]
      [[^hasCustomGroups]]
      <label>
        <input type="checkbox" class="admin"
            [[#isAdmin]]checked[[/isAdmin]]>
        Administrator
      </label>
      [[/hasCustomGroups]]
    [[/group]]
    [[^group]]
      <ul>
        <li class="permission aui-lozenge aui-lozenge-complete
            [[^read]]aui-lozenge-subtle[[/read]]"
            data-permission="read">
          read
        </li>
        <li class="permission aui-lozenge aui-lozenge-complete
            [[^write]]aui-lozenge-subtle[[/write]]"
            data-permission="write">
          write
        </li>
        <li class="permission aui-lozenge aui-lozenge-complete
            [[^admin]]aui-lozenge-subtle[[/admin]]"
            data-permission="admin">
          admin
        </li>
      </ul>
    [[/group]]
  </div>
</td>
<td class="actions
    [[#hasCustomGroups]]custom-groups[[/hasCustomGroups]]">
  <div>
    <a href="#" class="delete">
      <span class="aui-icon aui-icon-small aui-iconfont-remove">Delete</span>
    </a>
  </div>
</td>

      </script>
    
      <script id="share-team-template" type="text/html">
        

<div class="clearfix">
  <span class="team-avatar-container">
    <span class="aui-avatar aui-avatar-medium">
      <span class="aui-avatar-inner">
        <img src="[[avatar]]">
      </span>
    </span>
  </span>
  <span class="team-name-container">
    [[display_name]]
  </span>
</div>
<p class="helptext">
  
    Existing users are granted access to this team immediately.
    New users will be sent an invitation.
  
</p>
<div class="share-form"></div>

      </script>
    
      <script id="scope-list-template" type="text/html">
        <ul class="scope-list">
  [[#scopes]]
    <li class="scope-list--item">
      <span class="scope-list--icon aui-icon aui-icon-small [[icon]]"></span>
      <span class="scope-list--description">[[description]]</span>
    </li>
  [[/scopes]]
</ul>

      </script>
    
      <script id="omnibar-form-template" type="text/html">
        <div class="omnibar-input-container">
  <input class="omnibar-input" type="text" [[#placeholder]]placeholder="[[placeholder]]"[[/placeholder]]>
</div>
<ul class="omnibar-result-group-list"></ul>

      </script>
    
      <script id="omnibar-blank-slate-template" type="text/html">
        

<div class="omnibar-blank-slate">No results found</div>

      </script>
    
      <script id="omnibar-result-group-list-item-template" type="text/html">
        <div class="omnibar-result-group-header clearfix">
  <h2 class="omnibar-result-group-label" title="[[label]]">[[label]]</h2>
  <span class="omnibar-result-group-context" title="[[context]]">[[context]]</span>
</div>
<ul class="omnibar-result-list unstyled-list"></ul>

      </script>
    
      <script id="omnibar-result-list-item-template" type="text/html">
        [[#url]]
  <a href="[[&url]]" class="omnibar-result-label">[[&label]]</a>
[[/url]]
[[^url]]
  <span class="omnibar-result-label">[[&label]]</span>
[[/url]]
[[#context]]
  <span class="omnibar-result-context">[[context]]</span>
[[/context]]

      </script>
    
  </div>




  
    <script nonce="R8rBu1g29CAnA2xS">
  window.__initial_state__ = {"global": {"features": {"pr-merge-sign-off": true, "comment-likes": true, "fast-pr-merges": true, "twofactor-u2f": true, "clone-mirrors": true, "repo-onboarding": true, "require-issue-key": true, "snippets": true, "adg3": true, "fabric-emoji": true, "revert-pull-request": true, "new-dashboard": true, "integrations-page": true, "online-ides": true, "new-signup-flow": true, "fe_word_diff": true, "clonebundles": true, "use-moneybucket": true, "pinned-issue-comments": true, "invitation-matching-email": true, "2017-logos": true, "diff-renames-public": true, "app-passwords": true, "ignore-whitespace-button": true, "trello-boards": true, "atlassian-editor": true, "squash-merge": true, "pr-shared-component": true, "build-status": true, "code-search-cta": true, "projects": true, "evolution": false, "pr-checkout-command": true, "new-features-management": true, "repo-avatar-revival": true, "diff-renames-internal": true, "search-syntax-highlighting": true, "code-search-cta-launch": true, "new-features": true, "promote-bello": true, "search-results-adg3-page": true, "lfs_post_beta": true, "rollout-bello": true, "two-step": true, "bundle-splitting": true}, "locale": "en", "geoip_country": "UA", "targetFeatures": {"pr-merge-sign-off": true, "comment-likes": true, "fast-pr-merges": true, "twofactor-u2f": true, "clone-mirrors": true, "repo-onboarding": true, "require-issue-key": true, "snippets": true, "adg3": true, "fabric-emoji": true, "revert-pull-request": true, "new-dashboard": true, "integrations-page": true, "online-ides": true, "new-signup-flow": true, "fe_word_diff": true, "clonebundles": true, "use-moneybucket": true, "pinned-issue-comments": true, "invitation-matching-email": true, "2017-logos": true, "diff-renames-public": true, "app-passwords": true, "ignore-whitespace-button": true, "trello-boards": true, "atlassian-editor": false, "squash-merge": true, "pr-shared-component": true, "build-status": true, "code-search-cta": true, "projects": true, "evolution": false, "pr-checkout-command": true, "new-features-management": true, "repo-avatar-revival": true, "diff-renames-internal": true, "search-syntax-highlighting": true, "code-search-cta-launch": true, "new-features": true, "promote-bello": true, "search-results-adg3-page": true, "lfs_post_beta": true, "rollout-bello": true, "two-step": true, "bundle-splitting": true}, "isFocusedTask": false, "teams": [], "bitbucketActions": [{"analytics_label": null, "icon_class": "", "badge_label": null, "weight": 100, "url": "/repo/create?owner=mst777", "tab_name": null, "can_display": true, "label": "<strong>Repository<\/strong>", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "repository-create-drawer-item", "icon": ""}, {"analytics_label": null, "icon_class": "", "badge_label": null, "weight": 110, "url": "/account/create-team/", "tab_name": null, "can_display": true, "label": "<strong>Team<\/strong>", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "team-create-drawer-item", "icon": ""}, {"analytics_label": null, "icon_class": "", "badge_label": null, "weight": 120, "url": "/account/projects/create?owner=mst777", "tab_name": null, "can_display": true, "label": "<strong>Project<\/strong>", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "project-create-drawer-item", "icon": ""}, {"analytics_label": null, "icon_class": "", "badge_label": null, "weight": 130, "url": "/snippets/new?owner=mst777", "tab_name": null, "can_display": true, "label": "<strong>Snippet<\/strong>", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "snippet-create-drawer-item", "icon": ""}], "targetUser": {"username": "mst777", "website": "", "display_name": "DiMaco mb", "account_id": "557058:8aef176a-e0af-469d-94dc-420e732e1f44", "links": {"self": {"href": "https://bitbucket.org/!api/2.0/users/mst777"}, "html": {"href": "https://bitbucket.org/mst777/"}, "avatar": {"href": "https://bitbucket.org/account/mst777/avatar/32/"}}, "extra": {"has_atlassian_account": true}, "created_on": "2015-03-02T09:39:46.761722+00:00", "is_staff": false, "location": null, "type": "user", "uuid": "{102fbc9b-6b05-444d-b783-fe5fbf7c8001}"}, "isNavigationOpen": true, "path": "/mst777/zerx_tv/issues/598/curl", "focusedTaskBackButtonUrl": "https://bitbucket.org/mst777/zerx_tv/issues?page=12", "currentUser": {"username": "yybitb", "website": "", "display_name": "yybitb", "account_id": "557058:50b49aec-0028-4a41-8874-55077e86133c", "links": {"self": {"href": "https://bitbucket.org/!api/2.0/users/yybitb"}, "html": {"href": "https://bitbucket.org/yybitb/"}, "avatar": {"href": "https://bitbucket.org/account/yybitb/avatar/32/"}}, "extra": {"has_atlassian_account": true}, "created_on": "2014-06-09T11:01:23.433391+00:00", "is_staff": false, "location": null, "type": "user", "uuid": "{d2ee9cfe-6807-4b0b-b199-aec6bc17e1c6}"}}, "repository": {"section": {"connectActions": [], "cloneProtocol": "https", "currentRepository": {"scm": "git", "name": "zerx_tv", "links": {"clone": [{"href": "https://yybitb@bitbucket.org/mst777/zerx_tv.git", "name": "https"}, {"href": "ssh://git@bitbucket.org/mst777/zerx_tv.git", "name": "ssh"}], "self": {"href": "https://bitbucket.org/!api/2.0/repositories/mst777/zerx_tv"}, "html": {"href": "https://bitbucket.org/mst777/zerx_tv"}, "avatar": {"href": "https://bitbucket.org/mst777/zerx_tv/avatar/32/"}}, "full_name": "mst777/zerx_tv", "owner": {"username": "mst777", "website": "", "display_name": "DiMaco mb", "account_id": "557058:8aef176a-e0af-469d-94dc-420e732e1f44", "links": {"self": {"href": "https://bitbucket.org/!api/2.0/users/mst777"}, "html": {"href": "https://bitbucket.org/mst777/"}, "avatar": {"href": "https://bitbucket.org/account/mst777/avatar/32/"}}, "created_on": "2015-03-02T09:39:46.761722+00:00", "is_staff": false, "location": null, "type": "user", "uuid": "{102fbc9b-6b05-444d-b783-fe5fbf7c8001}"}, "type": "repository", "slug": "zerx_tv", "uuid": "{45d80fa9-cf10-45d7-a08b-3e764391c558}"}, "menuItems": [{"analytics_label": "repository.overview", "icon_class": "icon-overview", "badge_label": null, "weight": 100, "url": "/mst777/zerx_tv/overview", "tab_name": "overview", "can_display": true, "label": "Overview", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "repo-overview-link", "icon": "icon-overview"}, {"analytics_label": "repository.source", "icon_class": "icon-source", "badge_label": null, "weight": 200, "url": "/mst777/zerx_tv/src", "tab_name": "source", "can_display": true, "label": "Source", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "repo-source-link", "icon": "icon-source"}, {"analytics_label": "repository.commits", "icon_class": "icon-commits", "badge_label": null, "weight": 300, "url": "/mst777/zerx_tv/commits/", "tab_name": "commits", "can_display": true, "label": "Commits", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "repo-commits-link", "icon": "icon-commits"}, {"analytics_label": "repository.branches", "icon_class": "icon-branches", "badge_label": null, "weight": 400, "url": "/mst777/zerx_tv/branches/", "tab_name": "branches", "can_display": true, "label": "Branches", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "repo-branches-link", "icon": "icon-branches"}, {"analytics_label": "repository.pullrequests", "icon_class": "icon-pull-requests", "badge_label": "0 open pull requests", "weight": 500, "url": "/mst777/zerx_tv/pull-requests/", "tab_name": "pullrequests", "can_display": true, "label": "Pull requests", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "repo-pullrequests-link", "icon": "icon-pull-requests"}, {"analytics_label": "issues", "icon_class": "icon-issues", "badge_label": "36 active issues", "weight": 600, "url": "/mst777/zerx_tv/issues?status=new&status=open", "tab_name": "issues", "can_display": true, "label": "Issues", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "repo-issues-link", "icon": "icon-issues"}, {"analytics_label": "repository.wiki", "icon_class": "icon-wiki", "badge_label": null, "weight": 700, "url": "/mst777/zerx_tv/wiki/", "tab_name": "wiki", "can_display": true, "label": "Wiki", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "repo-wiki-link", "icon": "icon-wiki"}, {"analytics_label": "repository.downloads", "icon_class": "icon-downloads", "badge_label": null, "weight": 800, "url": "/mst777/zerx_tv/downloads/", "tab_name": "downloads", "can_display": true, "label": "Downloads", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "repo-downloads-link", "icon": "icon-downloads"}, {"analytics_label": "site.addon", "icon_class": "aui-iconfont-unfocus", "badge_label": null, "weight": 100, "url": "/mst777/zerx_tv/addon/bitbucket-trello-integration-installer/trello-board", "tab_name": "repopage-74Mgx6-add-on-link", "can_display": true, "label": "Boards", "anchor": false, "analytics_payload": {}, "icon_url": "https://bitbucket-assetroot.s3.amazonaws.com/add-on/icons/35ceae0c-17b1-443c-a6e8-d9de1d7cccdb.svg?Signature=QjHKbv3l9oTVmnvTGl5Gy8j7Ce4%3D&Expires=1505384962&AWSAccessKeyId=AKIAIQWXW6WLXMB5QZAQ&versionId=3oqdrZZjT.HijZ3kHTPsXE6IcSjhCG.P", "type": "connect_menu_item", "id": "repopage-74Mgx6-add-on-link", "target": "_self"}], "bitbucketActions": [{"analytics_label": "repository.clone", "icon_class": "icon-clone", "badge_label": null, "weight": 100, "url": "#clone", "tab_name": "clone", "can_display": true, "label": "<strong>Clone<\/strong> this repository", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "repo-clone-button", "icon": "icon-clone"}, {"analytics_label": "repository.create_branch", "icon_class": "icon-create-branch", "badge_label": null, "weight": 200, "url": "/mst777/zerx_tv/branch", "tab_name": "create-branch", "can_display": true, "label": "Create a <strong>branch<\/strong>", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "repo-create-branch-link", "icon": "icon-create-branch"}, {"analytics_label": "create_pullrequest", "icon_class": "icon-create-pull-request", "badge_label": null, "weight": 300, "url": "/mst777/zerx_tv/pull-requests/new", "tab_name": "create-pullreqs", "can_display": true, "label": "Create a <strong>pull request<\/strong>", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "repo-create-pull-request-link", "icon": "icon-create-pull-request"}, {"analytics_label": "repository.compare", "icon_class": "aui-icon-small aui-iconfont-devtools-compare", "badge_label": null, "weight": 400, "url": "/mst777/zerx_tv/branches/compare", "tab_name": "compare", "can_display": true, "label": "<strong>Compare<\/strong> branches or tags", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "repo-compare-link", "icon": "aui-icon-small aui-iconfont-devtools-compare"}, {"analytics_label": "repository.fork", "icon_class": "icon-fork", "badge_label": null, "weight": 500, "url": "/mst777/zerx_tv/fork", "tab_name": "fork", "can_display": true, "label": "<strong>Fork<\/strong> this repository", "anchor": true, "analytics_payload": {}, "target": "_self", "type": "menu_item", "id": "repo-fork-link", "icon": "icon-fork"}], "activeMenuItem": "issues"}}};
  window.__settings__ = {"SOCIAL_AUTH_ATLASSIANID_LOGOUT_URL": "https://id.atlassian.com/logout", "CANON_URL": "https://bitbucket.org", "API_CANON_URL": "https://api.bitbucket.org"};
</script>
<script src="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/jsi18n/en/djangojs.js"></script>

  <script src="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/dist/webpack/locales/en.js"></script>

<script src="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/dist/webpack/common.js"></script>
<script src="https://d301sr5gafysq2.cloudfront.net/4373ea877c7d/dist/webpack/issues.js"></script>
  


<script async src="https://www.google-analytics.com/analytics.js"></script>

<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","queueTime":0,"licenseKey":"a2cef8c3d3","agent":"","transactionName":"Z11RZxdWW0cEVkYLDV4XdUYLVEFdClsdAAtEWkZQDlJBGgRFQhFMWUtARgBEG0IMUEURWFlLQEYA","applicationID":"1841284","errorBeacon":"bam.nr-data.net","applicationTime":1859}</script>
</body>
</html>